<!DOCTYPE html>
<html data-theme="light" lang="en">
  <head>
    <%- include('./partials/head.ejs'); %>
    <title>Dashboard | DonateLife</title>
  </head>
  <body
    class="min-h-screen"
    style="
      background-image: url('/pics/recipient.png');
      background-size: cover;
      background-position: center;
    "
  >
    <!-- Sidebar -->
    <div class="flex min-h-screen">
      <%- include('./partials/donor-sidebar.ejs') %>

      <!-- Main Panel -->
      <main class="flex-1 p-2 space-y-10 flex items-center justify-center">
        <!-- Donor Info Card -->
        <div
          class="flex flex-col items-center w-[800px] backdrop-blur-md bg-white/30 p-4 rounded-2xl shadow-xl border border-white/30"
        >
          <!-- Avatar -->
          <div class="flex flex-col items-center mt-8 text-center">
            <div
              class="w-24 h-24 rounded-full border-4 border-white shadow-lg overflow-hidden"
            >
              <img
                src="/icons/user.svg"
                alt="Donor Avatar"
                class="w-full h-full object-cover"
              />
            </div>
            <h3 class="text-2xl font-semibold mt-4">
              <%= userDonor.donorUserId.username %>
            </h3>
          </div>

          <!-- Donor Info Display -->
          <div class="text-center mt-6 space-y-4">
            <div class="text-sm font-medium text-gray-700">
              Full Name:
              <span class="text-lg text-gray-500"><%= userDonor.name %></span>
            </div>
            <div class="text-sm font-medium text-gray-700">
              Age:
              <span class="text-lg text-gray-500"><%= userDonor.age %></span>
            </div>
            <div class="text-sm font-medium text-gray-700">
              Phone Number:
              <span class="text-lg text-gray-500"><%= userDonor.phone %></span>
            </div>
            <div class="text-sm font-medium text-gray-700">
              Address:
              <span class="text-lg text-gray-500"
                ><%= userDonor.address %></span
              >
            </div>
            <div class="text-sm font-medium text-gray-700">
              National ID:
              <span class="text-lg text-gray-500"><%= userDonor.nid %></span>
            </div>
            <div class="text-sm font-medium text-gray-700">
              Blood Group:
              <span class="text-lg text-gray-500"
                ><%= userDonor.bloodgroup %></span
              >
            </div>
            <div class="text-sm font-medium text-gray-700">
              Last Donation Date:
              <span class="text-lg text-gray-500"
                ><%= new Date(userDonor.lastdonation).toISOString().slice(0, 10)   %></span
              >
            </div>
              <div class="text-sm font-medium text-gray-700">

              <a href="/donor/dashboard/edit-details"
                class="bg-red-600 text-white py-3 px-6 rounded-full shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"
              >
                Edit Details
              </a>
            </div>
          </div>

          <!-- Edit Button -->
          <div class="mt-10 text-center">
            <a
              href="/donor/edit"
              class="bg-white/30 text-white px-4 py-1 rounded-full text-xs font-semibold tracking-wide"
              >Edit Details</a
            >
          </div>
        </div>
      </main>
    </div>
 <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
<script>
  console.log("socket script loaded");

  const userId = "<%= userDonor ? userDonor.donorUserId._id : '' %>";
  console.log("Donor userId:", userId);

  if (userId) {
    const socket = io(); 

    // Wait until the client genuinely connects
    socket.on("connect", () => {
      console.log("socket connected:", socket.id);

      socket.emit("joinRoom", userId);
      console.log("emitted joinRoom:", userId);
    });

    socket.on("newRequest", data => {
      console.log("ðŸ“¢ newRequest:", data);
      alert(`New blood request for ${data.bloodgroup} at ${data.location}`);
    });

    socket.on("requestAccepted", data => {
      console.log("âœ… requestAccepted:", data);
      alert("Your blood request has been accepted!");
    });

    socket.on("disconnect", reason => {
      console.log("socket disconnected:", reason);
    });

  } else {
    console.error("userDonor not defined. Socket not initialized.");
  }
</script>




  </body>
</html>
